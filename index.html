<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FlyClash Converter PRO - Itsbad</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        header {
            background: #222;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 22px;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            font-size: 15px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-top: 20px;
        }

        select, input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
        }

        button {
            background: #007bff;
            color: white;
            padding: 12px;
            border: none;
            width: 100%;
            border-radius: 6px;
            font-size: 17px;
            cursor: pointer;
            margin-top: 15px;
        }

        button:hover {
            background: #0056d6;
        }

        .help {
            cursor: pointer;
            font-weight: bold;
            color: #007bff;
            margin-left: 5px;
        }

        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            max-width: 350px;
        }
        .popup button {
            background: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<header>FlyClash Converter PRO - Itsbad</header>

<div class="container">
    <div class="section-title">Masukkan Link V2Ray / VLESS</div>
    <textarea id="inputConfig" placeholder="Masukkan config VLESS/Vmess..."></textarea>

    <div class="section-title">Mode Generator <span class="help" onclick="openPopup('modeInfo')">?</span></div>
    <select id="mode">
        <option value="manual">Manual</option>
        <option value="bestping">Best Ping</option>
        <option value="loadbalance">Load Balance</option>
        <option value="fallback">Fallback</option>
        <option value="blockads">Block Ads</option>
    </select>

    <div class="section-title">DNS <span class="help" onclick="openPopup('dnsInfo')">?</span></div>
    <select id="dnsMode">
        <option value="default">Default</option>
        <option value="fakeip">Fake-IP</option>
        <option value="custom">Custom</option>
    </select>

    <input type="text" id="dnsCustom" placeholder="DNS Custom (jika dipilih custom)" />

    <button onclick="generateConfig()">Generate FlyClash</button>

    <div class="section-title">Output Config FlyClash</div>
    <textarea id="outputConfig" readonly></textarea>
</div>

<!-- POPUP INFO -->
<div id="modeInfo" class="popup">
    <b>Penjelasan Mode:</b><br><br>
    <b>Manual:</b> Hanya memilih 1 server saja.<br>
    <b>Best Ping:</b> FlyClash otomatis memilih ping server terbaik.<br>
    <b>Load Balance:</b> Semua server dipakai bergantian.<br>
    <b>Fallback:</b> Server utama mati â†’ otomatis pindah ke cadangan.<br>
    <b>Block Ads:</b> Memblokir iklan & tracking DNS.<br>
    <button onclick="closePopup('modeInfo')">Tutup</button>
</div>

<div id="dnsInfo" class="popup">
    <b>DNS Mode:</b><br><br>
    <b>Default:</b> DNS bawaan FlyClash.<br>
    <b>Fake-IP:</b> Untuk kompatibilitas game atau app tertentu.<br>
    <b>Custom:</b> Masukkan DNS sendiri (contoh: 1.1.1.1, 8.8.8.8).<br>
    <button onclick="closePopup('dnsInfo')">Tutup</button>
</div>

<script>
function openPopup(id){ document.getElementById(id).style.display='block'; }
function closePopup(id){ document.getElementById(id).style.display='none'; }

function parseVLESS(url){
    try{
        const u = new URL(url.replace(/vless:\/\//, 'https://'));
        return {
            uuid: u.username,
            host: u.hostname,
            port: u.port,
            sni: u.searchParams.get('sni'),
            path: u.searchParams.get('path'),
            wsHost: u.searchParams.get('host')
        };
    }catch(e){ return null; }
}

function generateConfig(){
    const text = document.getElementById("inputConfig").value.trim().split(/\n+/);
    const mode = document.getElementById("mode").value;
    const dnsMode = document.getElementById("dnsMode").value;
    const dnsCustom = document.getElementById("dnsCustom").value.trim();

    let proxies = [];
    text.forEach(line=>{
        if(line.startsWith("vless://")){
            const p = parseVLESS(line);
            if(p) proxies.push(p);
        }
    });

    let dnsSection = "    dns:\n      enable: true\n";
    if(dnsMode === "fakeip") dnsSection += "      fake-ip: true\n";
    if(dnsMode === "custom") dnsSection += `      nameserver: [${dnsCustom}]\n`;

    let proxyList = proxies.map((p,i)=>`  - name: NODE-${i+1}\n    type: vless\n    server: ${p.host}\n    port: ${p.port}\n    uuid: ${p.uuid}\n    tls: true\n    sni: ${p.sni}\n    network: ws\n    ws-opts:\n      path: ${p.path}\n      headers:\n        Host: ${p.wsHost}`).join("\n\n");

    let group = "";
    if(mode === "manual") group = "    type: select\n    proxies: [" + proxies.map((p,i)=>`NODE-${i+1}`).join(", ") + "]";
    if(mode === "bestping") group = "    type: url-test\n    url: http://cp.cloudflare.com\n    interval: 3\n    proxies: [" + proxies.map((p,i)=>`NODE-${i+1}`).join(", ") + "]";
    if(mode === "loadbalance") group = "    type: load-balance\n    proxies: [" + proxies.map((p,i)=>`NODE-${i+1}`).join(", ") + "]";
    if(mode === "fallback") group = "    type: fallback\n    proxies: [" + proxies.map((p,i)=>`NODE-${i+1}`).join(", ") + "]";
    if(mode === "blockads") group = "    type: select\n    proxies: [REJECT, " + proxies.map((p,i)=>`NODE-${i+1}`).join(", ") + "]";

    const finalConfig =
`port: 7890
socks-port: 7891
allow-lan: true
mode: rule
log-level: info

${dnsSection}
proxies:
${proxyList}

proxy-groups:
  - name: "AUTO"
${group}

rules:
  - GEOIP,CN,DIRECT
  - MATCH,AUTO
`;

    document.getElementById("outputConfig").value = finalConfig;
}
</script>
</body>
</html>
